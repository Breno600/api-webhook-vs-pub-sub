Exec using JSCH
Connecting to 10.218.238.144 ....
Connection to 10.218.238.144 established
Executing command ...
export GIT_TAG=DEV000000007
Clonando repo em /tmp/tmp.WtpU06nug6...
Cloning into '/tmp/tmp.WtpU06nug6/elastic-compute-cloud-sitef'...
remote: Enumerating objects: 576, done.
remote: Counting objects:   0% (1/526)
remote: Counting objects:   1% (6/526)
remote: Counting objects:   2% (11/526)
remote: Counting objects:   3% (16/526)
remote: Counting objects:   4% (22/526)
remote: Counting objects:   5% (27/526)
remote: Counting objects:   6% (32/526)
remote: Counting objects:   7% (37/526)
remote: Counting objects:   8% (43/526)
remote: Counting objects:   9% (48/526)
remote: Counting objects:  10% (53/526)
remote: Counting objects:  11% (58/526)
remote: Counting objects:  12% (64/526)
remote: Counting objects:  13% (69/526)
remote: Counting objects:  14% (74/526)
remote: Counting objects:  15% (79/526)
remote: Counting objects:  16% (85/526)
remote: Counting objects:  17% (90/526)
remote: Counting objects:  18% (95/526)
remote: Counting objects:  19% (100/526)
remote: Counting objects:  20% (106/526)
remote: Counting objects:  21% (111/526)
remote: Counting objects:  22% (116/526)
remote: Counting objects:  23% (121/526)
remote: Counting objects:  24% (127/526)
remote: Counting objects:  25% (132/526)
remote: Counting objects:  26% (137/526)
remote: Counting objects:  27% (143/526)
remote: Counting objects:  28% (148/526)
remote: Counting objects:  29% (153/526)
remote: Counting objects:  30% (158/526)
remote: Counting objects:  31% (164/526)
remote: Counting objects:  32% (169/526)
remote: Counting objects:  33% (174/526)
remote: Counting objects:  34% (179/526)
remote: Counting objects:  35% (185/526)
remote: Counting objects:  36% (190/526)
remote: Counting objects:  37% (195/526)
remote: Counting objects:  38% (200/526)
remote: Counting objects:  39% (206/526)
remote: Counting objects:  40% (211/526)
remote: Counting objects:  41% (216/526)
remote: Counting objects:  42% (221/526)
remote: Counting objects:  43% (227/526)
remote: Counting objects:  44% (232/526)
remote: Counting objects:  45% (237/526)
remote: Counting objects:  46% (242/526)
remote: Counting objects:  47% (248/526)
remote: Counting objects:  48% (253/526)
remote: Counting objects:  49% (258/526)
remote: Counting objects:  50% (263/526)
remote: Counting objects:  51% (269/526)
remote: Counting objects:  52% (274/526)
remote: Counting objects:  53% (279/526)
remote: Counting objects:  54% (285/526)
remote: Counting objects:  55% (290/526)
remote: Counting objects:  56% (295/526)
remote: Counting objects:  57% (300/526)
remote: Counting objects:  58% (306/526)
remote: Counting objects:  59% (311/526)
remote: Counting objects:  60% (316/526)
remote: Counting objects:  61% (321/526)
remote: Counting objects:  62% (327/526)
remote: Counting objects:  63% (332/526)
remote: Counting objects:  64% (337/526)
remote: Counting objects:  65% (342/526)
remote: Counting objects:  66% (348/526)
remote: Counting objects:  67% (353/526)
remote: Counting objects:  68% (358/526)
remote: Counting objects:  69% (363/526)
remote: Counting objects:  70% (369/526)
remote: Counting objects:  71% (374/526)
remote: Counting objects:  72% (379/526)
remote: Counting objects:  73% (384/526)
remote: Counting objects:  74% (390/526)
remote: Counting objects:  75% (395/526)
remote: Counting objects:  76% (400/526)
remote: Counting objects:  77% (406/526)
remote: Counting objects:  78% (411/526)
remote: Counting objects:  79% (416/526)
remote: Counting objects:  80% (421/526)
remote: Counting objects:  81% (427/526)
remote: Counting objects:  82% (432/526)
remote: Counting objects:  83% (437/526)
remote: Counting objects:  84% (442/526)
remote: Counting objects:  85% (448/526)
remote: Counting objects:  86% (453/526)
remote: Counting objects:  87% (458/526)
remote: Counting objects:  88% (463/526)
remote: Counting objects:  89% (469/526)
remote: Counting objects:  90% (474/526)
remote: Counting objects:  91% (479/526)
remote: Counting objects:  92% (484/526)
remote: Counting objects:  93% (490/526)
remote: Counting objects:  94% (495/526)
remote: Counting objects:  95% (500/526)
remote: Counting objects:  96% (505/526)
remote: Counting objects:  97% (511/526)
remote: Counting objects:  98% (516/526)
remote: Counting objects:  99% (521/526)
remote: Counting objects: 100% (526/526)
remote: Counting objects: 100% (526/526), done.
remote: Compressing objects:   0% (1/513)
remote: Compressing objects:   1% (6/513)
remote: Compressing objects:   2% (11/513)
remote: Compressing objects:   3% (16/513)
remote: Compressing objects:   4% (21/513)
remote: Compressing objects:   5% (26/513)
remote: Compressing objects:   6% (31/513)
remote: Compressing objects:   7% (36/513)
remote: Compressing objects:   8% (42/513)
remote: Compressing objects:   9% (47/513)
remote: Compressing objects:  10% (52/513)
remote: Compressing objects:  11% (57/513)
remote: Compressing objects:  12% (62/513)
remote: Compressing objects:  13% (67/513)
remote: Compressing objects:  14% (72/513)
remote: Compressing objects:  15% (77/513)
remote: Compressing objects:  16% (83/513)
remote: Compressing objects:  17% (88/513)
remote: Compressing objects:  18% (93/513)
remote: Compressing objects:  19% (98/513)
remote: Compressing objects:  20% (103/513)
remote: Compressing objects:  21% (108/513)
remote: Compressing objects:  22% (113/513)
remote: Compressing objects:  23% (118/513)
remote: Compressing objects:  24% (124/513)
remote: Compressing objects:  25% (129/513)
remote: Compressing objects:  26% (134/513)
remote: Compressing objects:  27% (139/513)
remote: Compressing objects:  28% (144/513)
remote: Compressing objects:  29% (149/513)
remote: Compressing objects:  30% (154/513)
remote: Compressing objects:  31% (160/513)
remote: Compressing objects:  32% (165/513)
remote: Compressing objects:  33% (170/513)
remote: Compressing objects:  34% (175/513)
remote: Compressing objects:  35% (180/513)
remote: Compressing objects:  36% (185/513)
remote: Compressing objects:  37% (190/513)
remote: Compressing objects:  38% (195/513)
remote: Compressing objects:  39% (201/513)
remote: Compressing objects:  40% (206/513)
remote: Compressing objects:  41% (211/513)
remote: Compressing objects:  42% (216/513)
remote: Compressing objects:  43% (221/513)
remote: Compressing objects:  44% (226/513)
remote: Compressing objects:  45% (231/513)
remote: Compressing objects:  46% (236/513)
remote: Compressing objects:  47% (242/513)
remote: Compressing objects:  48% (247/513)
remote: Compressing objects:  49% (252/513)
remote: Compressing objects:  50% (257/513)
remote: Compressing objects:  51% (262/513)
remote: Compressing objects:  52% (267/513)
remote: Compressing objects:  53% (272/513)
remote: Compressing objects:  54% (278/513)
remote: Compressing objects:  55% (283/513)
remote: Compressing objects:  56% (288/513)
remote: Compressing objects:  57% (293/513)
remote: Compressing objects:  58% (298/513)
remote: Compressing objects:  59% (303/513)
remote: Compressing objects:  60% (308/513)
remote: Compressing objects:  61% (313/513)
remote: Compressing objects:  62% (319/513)
remote: Compressing objects:  63% (324/513)
remote: Compressing objects:  64% (329/513)
remote: Compressing objects:  65% (334/513)
remote: Compressing objects:  66% (339/513)
remote: Compressing objects:  67% (344/513)
remote: Compressing objects:  68% (349/513)
remote: Compressing objects:  69% (354/513)
remote: Compressing objects:  70% (360/513)
remote: Compressing objects:  71% (365/513)
remote: Compressing objects:  72% (370/513)
remote: Compressing objects:  73% (375/513)
remote: Compressing objects:  74% (380/513)
remote: Compressing objects:  75% (385/513)
remote: Compressing objects:  76% (390/513)
remote: Compressing objects:  77% (396/513)
remote: Compressing objects:  78% (401/513)
remote: Compressing objects:  79% (406/513)
remote: Compressing objects:  80% (411/513)
remote: Compressing objects:  81% (416/513)
remote: Compressing objects:  82% (421/513)
remote: Compressing objects:  83% (426/513)
remote: Compressing objects:  84% (431/513)
remote: Compressing objects:  85% (437/513)
remote: Compressing objects:  86% (442/513)
remote: Compressing objects:  87% (447/513)
remote: Compressing objects:  88% (452/513)
remote: Compressing objects:  89% (457/513)
remote: Compressing objects:  90% (462/513)
remote: Compressing objects:  91% (467/513)
remote: Compressing objects:  92% (472/513)
remote: Compressing objects:  93% (478/513)
remote: Compressing objects:  94% (483/513)
remote: Compressing objects:  95% (488/513)
remote: Compressing objects:  96% (493/513)
remote: Compressing objects:  97% (498/513)
remote: Compressing objects:  98% (503/513)
remote: Compressing objects:  99% (508/513)
remote: Compressing objects: 100% (513/513)
remote: Compressing objects: 100% (513/513), done.
remote: Total 576 (delta 316), reused 0 (delta 0), pack-reused 50
Receiving objects:   0% (1/576)
Receiving objects:   1% (6/576)
Receiving objects:   2% (12/576)
Receiving objects:   3% (18/576)
Receiving objects:   4% (24/576)
Receiving objects:   5% (29/576)
Receiving objects:   6% (35/576)
Receiving objects:   7% (41/576)
Receiving objects:   8% (47/576)
Receiving objects:   9% (52/576)
Receiving objects:  10% (58/576)
Receiving objects:  11% (64/576)
Receiving objects:  12% (70/576)
Receiving objects:  13% (75/576)
Receiving objects:  14% (81/576)
Receiving objects:  15% (87/576)
Receiving objects:  16% (93/576)
Receiving objects:  17% (98/576)
Receiving objects:  18% (104/576)
Receiving objects:  19% (110/576)
Receiving objects:  20% (116/576)
Receiving objects:  21% (121/576)
Receiving objects:  22% (127/576)
Receiving objects:  23% (133/576)
Receiving objects:  24% (139/576)
Receiving objects:  25% (144/576)
Receiving objects:  26% (150/576)
Receiving objects:  27% (156/576)
Receiving objects:  28% (162/576)
Receiving objects:  29% (168/576)
Receiving objects:  30% (173/576)
Receiving objects:  31% (179/576)
Receiving objects:  32% (185/576)
Receiving objects:  33% (191/576)
Receiving objects:  34% (196/576)
Receiving objects:  35% (202/576)
Receiving objects:  36% (208/576)
Receiving objects:  37% (214/576)
Receiving objects:  38% (219/576)
Receiving objects:  39% (225/576)
Receiving objects:  40% (231/576)
Receiving objects:  41% (237/576)
Receiving objects:  42% (242/576)
Receiving objects:  43% (248/576)
Receiving objects:  44% (254/576)
Receiving objects:  45% (260/576)
Receiving objects:  46% (265/576)
Receiving objects:  47% (271/576)
Receiving objects:  48% (277/576)
Receiving objects:  49% (283/576)
Receiving objects:  50% (288/576)
Receiving objects:  51% (294/576)
Receiving objects:  52% (300/576)
Receiving objects:  53% (306/576)
Receiving objects:  54% (312/576)
Receiving objects:  55% (317/576)
Receiving objects:  56% (323/576)
Receiving objects:  57% (329/576)
Receiving objects:  58% (335/576)
Receiving objects:  59% (340/576)
Receiving objects:  60% (346/576)
Receiving objects:  61% (352/576)
Receiving objects:  62% (358/576)
Receiving objects:  63% (363/576)
Receiving objects:  64% (369/576)
Receiving objects:  65% (375/576)
Receiving objects:  66% (381/576)
Receiving objects:  67% (386/576)
Receiving objects:  68% (392/576)
Receiving objects:  69% (398/576)
Receiving objects:  70% (404/576)
Receiving objects:  71% (409/576)
Receiving objects:  72% (415/576)
Receiving objects:  73% (421/576)
Receiving objects:  74% (427/576)
Receiving objects:  75% (432/576)
Receiving objects:  76% (438/576)
Receiving objects:  77% (444/576)
Receiving objects:  78% (450/576)
Receiving objects:  79% (456/576)
Receiving objects:  80% (461/576)
Receiving objects:  81% (467/576)
Receiving objects:  82% (473/576)
Receiving objects:  83% (479/576)
Receiving objects:  84% (484/576)
Receiving objects:  85% (490/576)
Receiving objects:  86% (496/576)
Receiving objects:  87% (502/576)
Receiving objects:  88% (507/576)
Receiving objects:  89% (513/576)
Receiving objects:  90% (519/576)
Receiving objects:  91% (525/576)
Receiving objects:  92% (530/576)
Receiving objects:  93% (536/576)
Receiving objects:  94% (542/576)
Receiving objects:  95% (548/576)
Receiving objects:  96% (553/576)
Receiving objects:  97% (559/576)
Receiving objects:  98% (565/576)
Receiving objects:  99% (571/576)
Receiving objects: 100% (576/576)
Receiving objects: 100% (576/576), 94.04 KiB | 1.27 MiB/s, done.
Resolving deltas:   0% (0/335)
Resolving deltas:   1% (4/335)
Resolving deltas:   2% (7/335)
Resolving deltas:   3% (11/335)
Resolving deltas:   4% (14/335)
Resolving deltas:   5% (17/335)
Resolving deltas:   6% (21/335)
Resolving deltas:   7% (24/335)
Resolving deltas:   8% (27/335)
Resolving deltas:   9% (31/335)
Resolving deltas:  10% (34/335)
Resolving deltas:  11% (37/335)
Resolving deltas:  12% (41/335)
Resolving deltas:  13% (44/335)
Resolving deltas:  14% (47/335)
Resolving deltas:  15% (51/335)
Resolving deltas:  16% (54/335)
Resolving deltas:  17% (57/335)
Resolving deltas:  18% (61/335)
Resolving deltas:  19% (64/335)
Resolving deltas:  20% (67/335)
Resolving deltas:  21% (71/335)
Resolving deltas:  22% (74/335)
Resolving deltas:  23% (78/335)
Resolving deltas:  24% (81/335)
Resolving deltas:  25% (84/335)
Resolving deltas:  26% (88/335)
Resolving deltas:  27% (91/335)
Resolving deltas:  28% (94/335)
Resolving deltas:  29% (98/335)
Resolving deltas:  30% (101/335)
Resolving deltas:  31% (104/335)
Resolving deltas:  32% (108/335)
Resolving deltas:  33% (111/335)
Resolving deltas:  34% (114/335)
Resolving deltas:  35% (118/335)
Resolving deltas:  36% (121/335)
Resolving deltas:  37% (124/335)
Resolving deltas:  38% (128/335)
Resolving deltas:  39% (131/335)
Resolving deltas:  40% (134/335)
Resolving deltas:  41% (138/335)
Resolving deltas:  42% (141/335)
Resolving deltas:  43% (145/335)
Resolving deltas:  44% (148/335)
Resolving deltas:  45% (151/335)
Resolving deltas:  46% (155/335)
Resolving deltas:  47% (158/335)
Resolving deltas:  48% (161/335)
Resolving deltas:  49% (165/335)
Resolving deltas:  50% (168/335)
Resolving deltas:  51% (171/335)
Resolving deltas:  52% (176/335)
Resolving deltas:  53% (178/335)
Resolving deltas:  54% (181/335)
Resolving deltas:  55% (185/335)
Resolving deltas:  56% (188/335)
Resolving deltas:  57% (191/335)
Resolving deltas:  58% (195/335)
Resolving deltas:  59% (198/335)
Resolving deltas:  60% (201/335)
Resolving deltas:  61% (205/335)
Resolving deltas:  62% (208/335)
Resolving deltas:  63% (212/335)
Resolving deltas:  64% (215/335)
Resolving deltas:  65% (218/335)
Resolving deltas:  66% (222/335)
Resolving deltas:  67% (225/335)
Resolving deltas:  68% (228/335)
Resolving deltas:  69% (232/335)
Resolving deltas:  70% (235/335)
Resolving deltas:  71% (238/335)
Resolving deltas:  72% (242/335)
Resolving deltas:  73% (245/335)
Resolving deltas:  74% (248/335)
Resolving deltas:  75% (252/335)
Resolving deltas:  76% (255/335)
Resolving deltas:  77% (258/335)
Resolving deltas:  78% (262/335)
Resolving deltas:  79% (265/335)
Resolving deltas:  80% (268/335)
Resolving deltas:  81% (273/335)
Resolving deltas:  82% (275/335)
Resolving deltas:  83% (279/335)
Resolving deltas:  84% (282/335)
Resolving deltas:  85% (285/335)
Resolving deltas:  86% (289/335)
Resolving deltas:  87% (292/335)
Resolving deltas:  88% (295/335)
Resolving deltas:  89% (299/335)
Resolving deltas:  90% (302/335)
Resolving deltas:  91% (305/335)
Resolving deltas:  92% (309/335)
Resolving deltas:  93% (312/335)
Resolving deltas:  94% (315/335)
Resolving deltas:  95% (319/335)
Resolving deltas:  96% (322/335)
Resolving deltas:  97% (325/335)
Resolving deltas:  98% (329/335)
Resolving deltas:  99% (332/335)
Resolving deltas: 100% (335/335)
Resolving deltas: 100% (335/335), done.
== PIPELINE PREDEPLOY ==
TAG   : DEV000000007
EXEC  : execution/machine_list_dev.yml
BRANCH: develop
[WARNING]: Unable to parse /tmp/tmp.WtpU06nug6/elastic-compute-cloud-
sitef/ansible/localhost as an inventory source
[WARNING]:  * Failed to parse /tmp/tmp.WtpU06nug6/elastic-compute-cloud-
sitef/ansible/deploy_from_status.yml with auto plugin: no root 'plugin' key
found, '/tmp/tmp.WtpU06nug6/elastic-compute-cloud-
sitef/ansible/deploy_from_status.yml' is not a valid YAML inventory plugin
config file
[WARNING]:  * Failed to parse /tmp/tmp.WtpU06nug6/elastic-compute-cloud-
sitef/ansible/deploy_from_status.yml with yaml plugin: YAML inventory has
invalid structure, it should be a dictionary, got: &lt;class
'ansible.parsing.yaml.objects.AnsibleSequence'>
[WARNING]:  * Failed to parse /tmp/tmp.WtpU06nug6/elastic-compute-cloud-
sitef/ansible/deploy_from_status.yml with ini plugin:
/tmp/tmp.WtpU06nug6/elastic-compute-cloud-
sitef/ansible/deploy_from_status.yml:8: Expected key=value host variable
assignment, got: name:
[WARNING]: Unable to parse /tmp/tmp.WtpU06nug6/elastic-compute-cloud-
sitef/ansible/deploy_from_status.yml as an inventory source
[WARNING]:  * Failed to parse /tmp/tmp.WtpU06nug6/elastic-compute-cloud-
sitef/ansible/deploy_per_machine.yml with auto plugin: no root 'plugin' key
found, '/tmp/tmp.WtpU06nug6/elastic-compute-cloud-
sitef/ansible/deploy_per_machine.yml' is not a valid YAML inventory plugin
config file
[WARNING]:  * Failed to parse /tmp/tmp.WtpU06nug6/elastic-compute-cloud-
sitef/ansible/deploy_per_machine.yml with yaml plugin: YAML inventory has
invalid structure, it should be a dictionary, got: &lt;class
'ansible.parsing.yaml.objects.AnsibleSequence'>
[WARNING]:  * Failed to parse /tmp/tmp.WtpU06nug6/elastic-compute-cloud-
sitef/ansible/deploy_per_machine.yml with ini plugin:
/tmp/tmp.WtpU06nug6/elastic-compute-cloud-
sitef/ansible/deploy_per_machine.yml:3: Expected key=value host variable
assignment, got: name:
[WARNING]: Unable to parse /tmp/tmp.WtpU06nug6/elastic-compute-cloud-
sitef/ansible/deploy_per_machine.yml as an inventory source
[WARNING]:  * Failed to parse /tmp/tmp.WtpU06nug6/elastic-compute-cloud-
sitef/ansible/predeploy_from_execution.yml with auto plugin: no root 'plugin'
key found, '/tmp/tmp.WtpU06nug6/elastic-compute-cloud-
sitef/ansible/predeploy_from_execution.yml' is not a valid YAML inventory
plugin config file
[WARNING]:  * Failed to parse /tmp/tmp.WtpU06nug6/elastic-compute-cloud-
sitef/ansible/predeploy_from_execution.yml with yaml plugin: YAML inventory has
invalid structure, it should be a dictionary, got: &lt;class
'ansible.parsing.yaml.objects.AnsibleSequence'>
[WARNING]:  * Failed to parse /tmp/tmp.WtpU06nug6/elastic-compute-cloud-
sitef/ansible/predeploy_from_execution.yml with ini plugin:
/tmp/tmp.WtpU06nug6/elastic-compute-cloud-
sitef/ansible/predeploy_from_execution.yml:15: Expected key=value host variable
assignment, got: name:
[WARNING]: Unable to parse /tmp/tmp.WtpU06nug6/elastic-compute-cloud-
sitef/ansible/predeploy_from_execution.yml as an inventory source
[WARNING]:  * Failed to parse /tmp/tmp.WtpU06nug6/elastic-compute-cloud-
sitef/ansible/predeploy_per_machine.yml with auto plugin: no root 'plugin' key
found, '/tmp/tmp.WtpU06nug6/elastic-compute-cloud-
sitef/ansible/predeploy_per_machine.yml' is not a valid YAML inventory plugin
config file
[WARNING]:  * Failed to parse /tmp/tmp.WtpU06nug6/elastic-compute-cloud-
sitef/ansible/predeploy_per_machine.yml with yaml plugin: YAML inventory has
invalid structure, it should be a dictionary, got: &lt;class
'ansible.parsing.yaml.objects.AnsibleSequence'>
[WARNING]:  * Failed to parse /tmp/tmp.WtpU06nug6/elastic-compute-cloud-
sitef/ansible/predeploy_per_machine.yml with ini plugin:
/tmp/tmp.WtpU06nug6/elastic-compute-cloud-
sitef/ansible/predeploy_per_machine.yml:7: Expected key=value host variable
assignment, got: name:
[WARNING]: Unable to parse /tmp/tmp.WtpU06nug6/elastic-compute-cloud-
sitef/ansible/predeploy_per_machine.yml as an inventory source
[WARNING]:  * Failed to parse /tmp/tmp.WtpU06nug6/elastic-compute-cloud-
sitef/ansible/rollback_from_status.yml with auto plugin: no root 'plugin' key
found, '/tmp/tmp.WtpU06nug6/elastic-compute-cloud-
sitef/ansible/rollback_from_status.yml' is not a valid YAML inventory plugin
config file
[WARNING]:  * Failed to parse /tmp/tmp.WtpU06nug6/elastic-compute-cloud-
sitef/ansible/rollback_from_status.yml with yaml plugin: YAML inventory has
invalid structure, it should be a dictionary, got: &lt;class
'ansible.parsing.yaml.objects.AnsibleSequence'>
[WARNING]:  * Failed to parse /tmp/tmp.WtpU06nug6/elastic-compute-cloud-
sitef/ansible/rollback_from_status.yml with ini plugin:
/tmp/tmp.WtpU06nug6/elastic-compute-cloud-
sitef/ansible/rollback_from_status.yml:3: Expected key=value host variable
assignment, got: name:
[WARNING]: Unable to parse /tmp/tmp.WtpU06nug6/elastic-compute-cloud-
sitef/ansible/rollback_from_status.yml as an inventory source
[WARNING]:  * Failed to parse /tmp/tmp.WtpU06nug6/elastic-compute-cloud-
sitef/ansible/rollback_per_machine.yml with auto plugin: no root 'plugin' key
found, '/tmp/tmp.WtpU06nug6/elastic-compute-cloud-
sitef/ansible/rollback_per_machine.yml' is not a valid YAML inventory plugin
config file
[WARNING]:  * Failed to parse /tmp/tmp.WtpU06nug6/elastic-compute-cloud-
sitef/ansible/rollback_per_machine.yml with yaml plugin: YAML inventory has
invalid structure, it should be a dictionary, got: &lt;class
'ansible.parsing.yaml.objects.AnsibleSequence'>
[WARNING]:  * Failed to parse /tmp/tmp.WtpU06nug6/elastic-compute-cloud-
sitef/ansible/rollback_per_machine.yml with ini plugin:
/tmp/tmp.WtpU06nug6/elastic-compute-cloud-
sitef/ansible/rollback_per_machine.yml:3: Expected key=value host variable
assignment, got: name:
[WARNING]: Unable to parse /tmp/tmp.WtpU06nug6/elastic-compute-cloud-
sitef/ansible/rollback_per_machine.yml as an inventory source
[WARNING]: Unable to parse /tmp/tmp.WtpU06nug6/elastic-compute-cloud-
sitef/ansible as an inventory source
[WARNING]: No inventory was parsed, only implicit localhost is available
[WARNING]: provided hosts list is empty, only localhost is available. Note that
the implicit localhost does not match 'all'
PLAY [Predeploy a partir do arquivo de execução] *******************************
TASK [Gathering Facts] *********************************************************
ok: [localhost]
TASK [Resolver filestore vars sem recursão] ************************************
fatal: [localhost]: FAILED! => {"msg": "The task includes an option with an undefined variable. The error was: 'filestore_env_resolved' is undefined. 'filestore_env_resolved' is undefined\n\nThe error appears to be in '/tmp/tmp.WtpU06nug6/elastic-compute-cloud-sitef/ansible/predeploy_from_execution.yml': line 36, column 7, but may\nbe elsewhere in the file depending on the exact syntax problem.\n\nThe offending line appears to be:\n\n  tasks:\n    - name: Resolver filestore vars sem recursão\n      ^ here\n"}
PLAY RECAP *********************************************************************
localhost                  : ok=1    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
Command finished with status FAILURE


# PIPELINE 1 - PREDEPLOY
# - Lê execution/<arquivo>.yml
# - Para cada máquina:
#   * carrega machine + package
#   * exporta env_vars (merge)
#   * prepara área /opt/SoftwareExpress/sitef-pipeline/deploy
#   * limpa scripts
#   * copia package.yml
#   * baixa componentes do Nexus
#   * copia scripts do repo
#   * executa init_parallel.sh
#   * gera status JSON
#   * envia JSON + LOG para Harness File Store

- name: "Predeploy a partir do arquivo de execução"
  hosts: localhost
  connection: local
  gather_facts: true

  vars:
    execution_file_name: "{{ execution_file_name | default('execution/machine_list_dev.yml') }}"
    deployment_ref: "{{ deployment_ref | default('DEV000000001') }}"
    repo_root: "{{ playbook_dir }}/.."
    status_dir: "{{ repo_root }}/status/{{ deployment_ref }}"

    # Nexus (ideal: vir do Harness Secrets)
    nexus_base_url: "{{ nexus_base_url | default('https://nexus-ci.onefiserv.net/repository/raw-apm0004548-dev') }}"
    nexus_user: "{{ nexus_user | default(omit) }}"
    nexus_password: "{{ nexus_password | default(omit) }}"

    # File Store base
    filestore_env: "dev"  # dev|cat|prd
    filestore_base_dir: "dev/{{ deployment_ref }}"

  tasks:
    - name: Resolver filestore vars sem recursão
      ansible.builtin.set_fact:
        filestore_env_resolved: "{{ filestore_env | default('dev') }}"
        filestore_base_dir_resolved: >-
          {{
            filestore_base_dir
              | default(filestore_env_resolved ~ '/' ~ deployment_ref)
          }}

    - name: "Mostrar variáveis de entrada"
      ansible.builtin.debug:
        msg:
          - "execution_file_name = {{ execution_file_name }}"
          - "filestore_env      = {{ filestore_env_resolved }}"
          - "filestore_base_dir = {{ filestore_base_dir_resolved }}"
          - "deployment_ref     = {{ deployment_ref }}"
          - "repo_root           = {{ repo_root }}"
          - "status_dir          = {{ status_dir }}"
          - "nexus_base_url      = {{ nexus_base_url }}"

    - name: "Criar diretório de status da TAG"
      ansible.builtin.file:
        path: "{{ status_dir }}"
        state: directory
        mode: "0755"

    - name: "Carregar arquivo de execução"
      ansible.builtin.include_vars:
        file: "{{ repo_root }}/{{ execution_file_name }}"
        name: execution_cfg

    - name: "Falhar se não tiver máquinas no arquivo de execução"
      ansible.builtin.fail:
        msg: "Nenhuma máquina encontrada em execution_cfg.machines"
      when: execution_cfg.machines is not defined or execution_cfg.machines | length == 0

    - name: "Executar pré-deploy por máquina"
      ansible.builtin.include_tasks: predeploy_per_machine.yml
      loop: "{{ execution_cfg.machines }}"
      loop_control:
        loop_var: machine_name
      vars:
        deployment_ref: "{{ deployment_ref }}"
        repo_root: "{{ repo_root }}"
        status_dir: "{{ status_dir }}"
        nexus_base_url: "{{ nexus_base_url }}"
        nexus_user: "{{ nexus_user | default('') }}"
        nexus_password: "{{ nexus_password | default('') }}"
        filestore_env: "{{ filestore_env }}"
        filestore_base_dir: "{{ filestore_base_dir }}"

