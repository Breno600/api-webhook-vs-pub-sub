Exec using JSCH
Connecting to 10.218.238.144 ....
Connection to 10.218.238.144 established
Executing command ...
export GIT_TAG=DEV000000007
Clonando repo em /tmp/tmp.dC4tGj6Zlj...
Cloning into '/tmp/tmp.dC4tGj6Zlj/elastic-compute-cloud-sitef'...
remote: Enumerating objects: 596, done.
remote: Counting objects:   0% (1/546)
remote: Counting objects:   1% (6/546)
remote: Counting objects:   2% (11/546)
remote: Counting objects:   3% (17/546)
remote: Counting objects:   4% (22/546)
remote: Counting objects:   5% (28/546)
remote: Counting objects:   6% (33/546)
remote: Counting objects:   7% (39/546)
remote: Counting objects:   8% (44/546)
remote: Counting objects:   9% (50/546)
remote: Counting objects:  10% (55/546)
remote: Counting objects:  11% (61/546)
remote: Counting objects:  12% (66/546)
remote: Counting objects:  13% (71/546)
remote: Counting objects:  14% (77/546)
remote: Counting objects:  15% (82/546)
remote: Counting objects:  16% (88/546)
remote: Counting objects:  17% (93/546)
remote: Counting objects:  18% (99/546)
remote: Counting objects:  19% (104/546)
remote: Counting objects:  20% (110/546)
remote: Counting objects:  21% (115/546)
remote: Counting objects:  22% (121/546)
remote: Counting objects:  23% (126/546)
remote: Counting objects:  24% (132/546)
remote: Counting objects:  25% (137/546)
remote: Counting objects:  26% (142/546)
remote: Counting objects:  27% (148/546)
remote: Counting objects:  28% (153/546)
remote: Counting objects:  29% (159/546)
remote: Counting objects:  30% (164/546)
remote: Counting objects:  31% (170/546)
remote: Counting objects:  32% (175/546)
remote: Counting objects:  33% (181/546)
remote: Counting objects:  34% (186/546)
remote: Counting objects:  35% (192/546)
remote: Counting objects:  36% (197/546)
remote: Counting objects:  37% (203/546)
remote: Counting objects:  38% (208/546)
remote: Counting objects:  39% (213/546)
remote: Counting objects:  40% (219/546)
remote: Counting objects:  41% (224/546)
remote: Counting objects:  42% (230/546)
remote: Counting objects:  43% (235/546)
remote: Counting objects:  44% (241/546)
remote: Counting objects:  45% (246/546)
remote: Counting objects:  46% (252/546)
remote: Counting objects:  47% (257/546)
remote: Counting objects:  48% (263/546)
remote: Counting objects:  49% (268/546)
remote: Counting objects:  50% (273/546)
remote: Counting objects:  51% (279/546)
remote: Counting objects:  52% (284/546)
remote: Counting objects:  53% (290/546)
remote: Counting objects:  54% (295/546)
remote: Counting objects:  55% (301/546)
remote: Counting objects:  56% (306/546)
remote: Counting objects:  57% (312/546)
remote: Counting objects:  58% (317/546)
remote: Counting objects:  59% (323/546)
remote: Counting objects:  60% (328/546)
remote: Counting objects:  61% (334/546)
remote: Counting objects:  62% (339/546)
remote: Counting objects:  63% (344/546)
remote: Counting objects:  64% (350/546)
remote: Counting objects:  65% (355/546)
remote: Counting objects:  66% (361/546)
remote: Counting objects:  67% (366/546)
remote: Counting objects:  68% (372/546)
remote: Counting objects:  69% (377/546)
remote: Counting objects:  70% (383/546)
remote: Counting objects:  71% (388/546)
remote: Counting objects:  72% (394/546)
remote: Counting objects:  73% (399/546)
remote: Counting objects:  74% (405/546)
remote: Counting objects:  75% (410/546)
remote: Counting objects:  76% (415/546)
remote: Counting objects:  77% (421/546)
remote: Counting objects:  78% (426/546)
remote: Counting objects:  79% (432/546)
remote: Counting objects:  80% (437/546)
remote: Counting objects:  81% (443/546)
remote: Counting objects:  82% (448/546)
remote: Counting objects:  83% (454/546)
remote: Counting objects:  84% (459/546)
remote: Counting objects:  85% (465/546)
remote: Counting objects:  86% (470/546)
remote: Counting objects:  87% (476/546)
remote: Counting objects:  88% (481/546)
remote: Counting objects:  89% (486/546)
remote: Counting objects:  90% (492/546)
remote: Counting objects:  91% (497/546)
remote: Counting objects:  92% (503/546)
remote: Counting objects:  93% (508/546)
remote: Counting objects:  94% (514/546)
remote: Counting objects:  95% (519/546)
remote: Counting objects:  96% (525/546)
remote: Counting objects:  97% (530/546)
remote: Counting objects:  98% (536/546)
remote: Counting objects:  99% (541/546)
remote: Counting objects: 100% (546/546)
remote: Counting objects: 100% (546/546), done.
remote: Compressing objects:   0% (1/533)
remote: Compressing objects:   1% (6/533)
remote: Compressing objects:   2% (11/533)
remote: Compressing objects:   3% (16/533)
remote: Compressing objects:   4% (22/533)
remote: Compressing objects:   5% (27/533)
remote: Compressing objects:   6% (32/533)
remote: Compressing objects:   7% (38/533)
remote: Compressing objects:   8% (43/533)
remote: Compressing objects:   9% (48/533)
remote: Compressing objects:  10% (54/533)
remote: Compressing objects:  11% (59/533)
remote: Compressing objects:  12% (64/533)
remote: Compressing objects:  13% (70/533)
remote: Compressing objects:  14% (75/533)
remote: Compressing objects:  15% (80/533)
remote: Compressing objects:  16% (86/533)
remote: Compressing objects:  17% (91/533)
remote: Compressing objects:  18% (96/533)
remote: Compressing objects:  19% (102/533)
remote: Compressing objects:  20% (107/533)
remote: Compressing objects:  21% (112/533)
remote: Compressing objects:  22% (118/533)
remote: Compressing objects:  23% (123/533)
remote: Compressing objects:  24% (128/533)
remote: Compressing objects:  25% (134/533)
remote: Compressing objects:  26% (139/533)
remote: Compressing objects:  27% (144/533)
remote: Compressing objects:  28% (150/533)
remote: Compressing objects:  29% (155/533)
remote: Compressing objects:  30% (160/533)
remote: Compressing objects:  31% (166/533)
remote: Compressing objects:  32% (171/533)
remote: Compressing objects:  33% (176/533)
remote: Compressing objects:  34% (182/533)
remote: Compressing objects:  35% (187/533)
remote: Compressing objects:  36% (192/533)
remote: Compressing objects:  37% (198/533)
remote: Compressing objects:  38% (203/533)
remote: Compressing objects:  39% (208/533)
remote: Compressing objects:  40% (214/533)
remote: Compressing objects:  41% (219/533)
remote: Compressing objects:  42% (224/533)
remote: Compressing objects:  43% (230/533)
remote: Compressing objects:  44% (235/533)
remote: Compressing objects:  45% (240/533)
remote: Compressing objects:  46% (246/533)
remote: Compressing objects:  47% (251/533)
remote: Compressing objects:  48% (256/533)
remote: Compressing objects:  49% (262/533)
remote: Compressing objects:  50% (267/533)
remote: Compressing objects:  51% (272/533)
remote: Compressing objects:  52% (278/533)
remote: Compressing objects:  53% (283/533)
remote: Compressing objects:  54% (288/533)
remote: Compressing objects:  55% (294/533)
remote: Compressing objects:  56% (299/533)
remote: Compressing objects:  57% (304/533)
remote: Compressing objects:  58% (310/533)
remote: Compressing objects:  59% (315/533)
remote: Compressing objects:  60% (320/533)
remote: Compressing objects:  61% (326/533)
remote: Compressing objects:  62% (331/533)
remote: Compressing objects:  63% (336/533)
remote: Compressing objects:  64% (342/533)
remote: Compressing objects:  65% (347/533)
remote: Compressing objects:  66% (352/533)
remote: Compressing objects:  67% (358/533)
remote: Compressing objects:  68% (363/533)
remote: Compressing objects:  69% (368/533)
remote: Compressing objects:  70% (374/533)
remote: Compressing objects:  71% (379/533)
remote: Compressing objects:  72% (384/533)
remote: Compressing objects:  73% (390/533)
remote: Compressing objects:  74% (395/533)
remote: Compressing objects:  75% (400/533)
remote: Compressing objects:  76% (406/533)
remote: Compressing objects:  77% (411/533)
remote: Compressing objects:  78% (416/533)
remote: Compressing objects:  79% (422/533)
remote: Compressing objects:  80% (427/533)
remote: Compressing objects:  81% (432/533)
remote: Compressing objects:  82% (438/533)
remote: Compressing objects:  83% (443/533)
remote: Compressing objects:  84% (448/533)
remote: Compressing objects:  85% (454/533)
remote: Compressing objects:  86% (459/533)
remote: Compressing objects:  87% (464/533)
remote: Compressing objects:  88% (470/533)
remote: Compressing objects:  89% (475/533)
remote: Compressing objects:  90% (480/533)
remote: Compressing objects:  91% (486/533)
remote: Compressing objects:  92% (491/533)
remote: Compressing objects:  93% (496/533)
remote: Compressing objects:  94% (502/533)
remote: Compressing objects:  95% (507/533)
remote: Compressing objects:  96% (512/533)
remote: Compressing objects:  97% (518/533)
remote: Compressing objects:  98% (523/533)
remote: Compressing objects:  99% (528/533)
remote: Compressing objects: 100% (533/533)
remote: Compressing objects: 100% (533/533), done.
remote: Total 596 (delta 335), reused 0 (delta 0), pack-reused 50
Receiving objects:   0% (1/596)
Receiving objects:   1% (6/596)
Receiving objects:   2% (12/596)
Receiving objects:   3% (18/596)
Receiving objects:   4% (24/596)
Receiving objects:   5% (30/596)
Receiving objects:   6% (36/596)
Receiving objects:   7% (42/596)
Receiving objects:   8% (48/596)
Receiving objects:   9% (54/596)
Receiving objects:  10% (60/596)
Receiving objects:  11% (66/596)
Receiving objects:  12% (72/596)
Receiving objects:  13% (78/596)
Receiving objects:  14% (84/596)
Receiving objects:  15% (90/596)
Receiving objects:  16% (96/596)
Receiving objects:  17% (102/596)
Receiving objects:  18% (108/596)
Receiving objects:  19% (114/596)
Receiving objects:  20% (120/596)
Receiving objects:  21% (126/596)
Receiving objects:  22% (132/596)
Receiving objects:  23% (138/596)
Receiving objects:  24% (144/596)
Receiving objects:  25% (149/596)
Receiving objects:  26% (155/596)
Receiving objects:  27% (161/596)
Receiving objects:  28% (167/596)
Receiving objects:  29% (173/596)
Receiving objects:  30% (179/596)
Receiving objects:  31% (185/596)
Receiving objects:  32% (191/596)
Receiving objects:  33% (197/596)
Receiving objects:  34% (203/596)
Receiving objects:  35% (209/596)
Receiving objects:  36% (215/596)
Receiving objects:  37% (221/596)
Receiving objects:  38% (227/596)
Receiving objects:  39% (233/596)
Receiving objects:  40% (239/596)
Receiving objects:  41% (245/596)
Receiving objects:  42% (251/596)
Receiving objects:  43% (257/596)
Receiving objects:  44% (263/596)
Receiving objects:  45% (269/596)
Receiving objects:  46% (275/596)
Receiving objects:  47% (281/596)
Receiving objects:  48% (287/596)
Receiving objects:  49% (293/596)
Receiving objects:  50% (298/596)
Receiving objects:  51% (304/596)
Receiving objects:  52% (310/596)
Receiving objects:  53% (316/596)
Receiving objects:  54% (322/596)
Receiving objects:  55% (328/596)
Receiving objects:  56% (334/596)
Receiving objects:  57% (340/596)
Receiving objects:  58% (346/596)
Receiving objects:  59% (352/596)
Receiving objects:  60% (358/596)
Receiving objects:  61% (364/596)
Receiving objects:  62% (370/596)
Receiving objects:  63% (376/596)
Receiving objects:  64% (382/596)
Receiving objects:  65% (388/596)
Receiving objects:  66% (394/596)
Receiving objects:  67% (400/596)
Receiving objects:  68% (406/596)
Receiving objects:  69% (412/596)
Receiving objects:  70% (418/596)
Receiving objects:  71% (424/596)
Receiving objects:  72% (430/596)
Receiving objects:  73% (436/596)
Receiving objects:  74% (442/596)
Receiving objects:  75% (447/596)
Receiving objects:  76% (453/596)
Receiving objects:  77% (459/596)
Receiving objects:  78% (465/596)
Receiving objects:  79% (471/596)
Receiving objects:  80% (477/596)
Receiving objects:  81% (483/596)
Receiving objects:  82% (489/596)
Receiving objects:  83% (495/596)
Receiving objects:  84% (501/596)
Receiving objects:  85% (507/596)
Receiving objects:  86% (513/596)
Receiving objects:  87% (519/596)
Receiving objects:  88% (525/596)
Receiving objects:  89% (531/596)
Receiving objects:  90% (537/596)
Receiving objects:  91% (543/596)
Receiving objects:  92% (549/596)
Receiving objects:  93% (555/596)
Receiving objects:  94% (561/596)
Receiving objects:  95% (567/596)
Receiving objects:  96% (573/596)
Receiving objects:  97% (579/596)
Receiving objects:  98% (585/596)
Receiving objects:  99% (591/596)
Receiving objects: 100% (596/596)
Receiving objects: 100% (596/596), 99.20 KiB | 331.00 KiB/s, done.
Resolving deltas:   0% (0/354)
Resolving deltas:   1% (4/354)
Resolving deltas:   2% (8/354)
Resolving deltas:   3% (11/354)
Resolving deltas:   4% (15/354)
Resolving deltas:   5% (18/354)
Resolving deltas:   6% (22/354)
Resolving deltas:   7% (26/354)
Resolving deltas:   8% (29/354)
Resolving deltas:   9% (32/354)
Resolving deltas:  10% (36/354)
Resolving deltas:  11% (39/354)
Resolving deltas:  12% (43/354)
Resolving deltas:  13% (47/354)
Resolving deltas:  14% (50/354)
Resolving deltas:  15% (54/354)
Resolving deltas:  16% (57/354)
Resolving deltas:  17% (61/354)
Resolving deltas:  18% (64/354)
Resolving deltas:  19% (68/354)
Resolving deltas:  20% (71/354)
Resolving deltas:  21% (75/354)
Resolving deltas:  22% (78/354)
Resolving deltas:  23% (82/354)
Resolving deltas:  24% (85/354)
Resolving deltas:  25% (89/354)
Resolving deltas:  26% (93/354)
Resolving deltas:  27% (96/354)
Resolving deltas:  28% (100/354)
Resolving deltas:  29% (103/354)
Resolving deltas:  30% (107/354)
Resolving deltas:  31% (110/354)
Resolving deltas:  32% (114/354)
Resolving deltas:  33% (117/354)
Resolving deltas:  34% (121/354)
Resolving deltas:  35% (124/354)
Resolving deltas:  36% (128/354)
Resolving deltas:  37% (131/354)
Resolving deltas:  38% (135/354)
Resolving deltas:  39% (139/354)
Resolving deltas:  40% (142/354)
Resolving deltas:  41% (146/354)
Resolving deltas:  42% (149/354)
Resolving deltas:  43% (153/354)
Resolving deltas:  44% (156/354)
Resolving deltas:  45% (160/354)
Resolving deltas:  46% (163/354)
Resolving deltas:  47% (168/354)
Resolving deltas:  48% (170/354)
Resolving deltas:  49% (174/354)
Resolving deltas:  50% (177/354)
Resolving deltas:  51% (181/354)
Resolving deltas:  52% (185/354)
Resolving deltas:  53% (188/354)
Resolving deltas:  54% (192/354)
Resolving deltas:  55% (195/354)
Resolving deltas:  56% (199/354)
Resolving deltas:  57% (202/354)
Resolving deltas:  58% (206/354)
Resolving deltas:  59% (209/354)
Resolving deltas:  60% (213/354)
Resolving deltas:  61% (216/354)
Resolving deltas:  62% (220/354)
Resolving deltas:  63% (224/354)
Resolving deltas:  64% (227/354)
Resolving deltas:  65% (231/354)
Resolving deltas:  66% (234/354)
Resolving deltas:  67% (238/354)
Resolving deltas:  68% (241/354)
Resolving deltas:  69% (245/354)
Resolving deltas:  70% (248/354)
Resolving deltas:  71% (252/354)
Resolving deltas:  72% (255/354)
Resolving deltas:  73% (259/354)
Resolving deltas:  74% (262/354)
Resolving deltas:  75% (266/354)
Resolving deltas:  76% (270/354)
Resolving deltas:  77% (273/354)
Resolving deltas:  78% (277/354)
Resolving deltas:  79% (280/354)
Resolving deltas:  80% (284/354)
Resolving deltas:  81% (287/354)
Resolving deltas:  82% (291/354)
Resolving deltas:  83% (294/354)
Resolving deltas:  84% (298/354)
Resolving deltas:  85% (301/354)
Resolving deltas:  86% (305/354)
Resolving deltas:  87% (308/354)
Resolving deltas:  88% (312/354)
Resolving deltas:  89% (316/354)
Resolving deltas:  90% (319/354)
Resolving deltas:  91% (323/354)
Resolving deltas:  92% (326/354)
Resolving deltas:  93% (330/354)
Resolving deltas:  94% (333/354)
Resolving deltas:  95% (337/354)
Resolving deltas:  96% (340/354)
Resolving deltas:  97% (344/354)
Resolving deltas:  98% (347/354)
Resolving deltas:  99% (351/354)
Resolving deltas: 100% (354/354)
Resolving deltas: 100% (354/354), done.
== PIPELINE PREDEPLOY ==
TAG   : DEV000000007
EXEC  : execution/machine_list_dev.yml
BRANCH: develop
[WARNING]: Unable to parse /tmp/tmp.dC4tGj6Zlj/elastic-compute-cloud-
sitef/ansible/localhost as an inventory source
[WARNING]:  * Failed to parse /tmp/tmp.dC4tGj6Zlj/elastic-compute-cloud-
sitef/ansible/deploy_from_status.yml with auto plugin: no root 'plugin' key
found, '/tmp/tmp.dC4tGj6Zlj/elastic-compute-cloud-
sitef/ansible/deploy_from_status.yml' is not a valid YAML inventory plugin
config file
[WARNING]:  * Failed to parse /tmp/tmp.dC4tGj6Zlj/elastic-compute-cloud-
sitef/ansible/deploy_from_status.yml with yaml plugin: YAML inventory has
invalid structure, it should be a dictionary, got: &lt;class
'ansible.parsing.yaml.objects.AnsibleSequence'>
[WARNING]:  * Failed to parse /tmp/tmp.dC4tGj6Zlj/elastic-compute-cloud-
sitef/ansible/deploy_from_status.yml with ini plugin:
/tmp/tmp.dC4tGj6Zlj/elastic-compute-cloud-
sitef/ansible/deploy_from_status.yml:8: Expected key=value host variable
assignment, got: name:
[WARNING]: Unable to parse /tmp/tmp.dC4tGj6Zlj/elastic-compute-cloud-
sitef/ansible/deploy_from_status.yml as an inventory source
[WARNING]:  * Failed to parse /tmp/tmp.dC4tGj6Zlj/elastic-compute-cloud-
sitef/ansible/deploy_per_machine.yml with auto plugin: no root 'plugin' key
found, '/tmp/tmp.dC4tGj6Zlj/elastic-compute-cloud-
sitef/ansible/deploy_per_machine.yml' is not a valid YAML inventory plugin
config file
[WARNING]:  * Failed to parse /tmp/tmp.dC4tGj6Zlj/elastic-compute-cloud-
sitef/ansible/deploy_per_machine.yml with yaml plugin: YAML inventory has
invalid structure, it should be a dictionary, got: &lt;class
'ansible.parsing.yaml.objects.AnsibleSequence'>
[WARNING]:  * Failed to parse /tmp/tmp.dC4tGj6Zlj/elastic-compute-cloud-
sitef/ansible/deploy_per_machine.yml with ini plugin:
/tmp/tmp.dC4tGj6Zlj/elastic-compute-cloud-
sitef/ansible/deploy_per_machine.yml:3: Expected key=value host variable
assignment, got: name:
[WARNING]: Unable to parse /tmp/tmp.dC4tGj6Zlj/elastic-compute-cloud-
sitef/ansible/deploy_per_machine.yml as an inventory source
[WARNING]:  * Failed to parse /tmp/tmp.dC4tGj6Zlj/elastic-compute-cloud-
sitef/ansible/predeploy_from_execution.yml with auto plugin: no root 'plugin'
key found, '/tmp/tmp.dC4tGj6Zlj/elastic-compute-cloud-
sitef/ansible/predeploy_from_execution.yml' is not a valid YAML inventory
plugin config file
[WARNING]:  * Failed to parse /tmp/tmp.dC4tGj6Zlj/elastic-compute-cloud-
sitef/ansible/predeploy_from_execution.yml with yaml plugin: YAML inventory has
invalid structure, it should be a dictionary, got: &lt;class
'ansible.parsing.yaml.objects.AnsibleSequence'>
[WARNING]:  * Failed to parse /tmp/tmp.dC4tGj6Zlj/elastic-compute-cloud-
sitef/ansible/predeploy_from_execution.yml with ini plugin:
/tmp/tmp.dC4tGj6Zlj/elastic-compute-cloud-
sitef/ansible/predeploy_from_execution.yml:22: Expected key=value host variable
assignment, got: name:
[WARNING]: Unable to parse /tmp/tmp.dC4tGj6Zlj/elastic-compute-cloud-
sitef/ansible/predeploy_from_execution.yml as an inventory source
[WARNING]:  * Failed to parse /tmp/tmp.dC4tGj6Zlj/elastic-compute-cloud-
sitef/ansible/predeploy_per_machine.yml with auto plugin: no root 'plugin' key
found, '/tmp/tmp.dC4tGj6Zlj/elastic-compute-cloud-
sitef/ansible/predeploy_per_machine.yml' is not a valid YAML inventory plugin
config file
[WARNING]:  * Failed to parse /tmp/tmp.dC4tGj6Zlj/elastic-compute-cloud-
sitef/ansible/predeploy_per_machine.yml with yaml plugin: YAML inventory has
invalid structure, it should be a dictionary, got: &lt;class
'ansible.parsing.yaml.objects.AnsibleSequence'>
[WARNING]:  * Failed to parse /tmp/tmp.dC4tGj6Zlj/elastic-compute-cloud-
sitef/ansible/predeploy_per_machine.yml with ini plugin: Invalid host pattern
'---' supplied, '---' is normally a sign this is a YAML file.
[WARNING]: Unable to parse /tmp/tmp.dC4tGj6Zlj/elastic-compute-cloud-
sitef/ansible/predeploy_per_machine.yml as an inventory source
[WARNING]:  * Failed to parse /tmp/tmp.dC4tGj6Zlj/elastic-compute-cloud-
sitef/ansible/rollback_from_status.yml with auto plugin: no root 'plugin' key
found, '/tmp/tmp.dC4tGj6Zlj/elastic-compute-cloud-
sitef/ansible/rollback_from_status.yml' is not a valid YAML inventory plugin
config file
[WARNING]:  * Failed to parse /tmp/tmp.dC4tGj6Zlj/elastic-compute-cloud-
sitef/ansible/rollback_from_status.yml with yaml plugin: YAML inventory has
invalid structure, it should be a dictionary, got: &lt;class
'ansible.parsing.yaml.objects.AnsibleSequence'>
[WARNING]:  * Failed to parse /tmp/tmp.dC4tGj6Zlj/elastic-compute-cloud-
sitef/ansible/rollback_from_status.yml with ini plugin:
/tmp/tmp.dC4tGj6Zlj/elastic-compute-cloud-
sitef/ansible/rollback_from_status.yml:3: Expected key=value host variable
assignment, got: name:
[WARNING]: Unable to parse /tmp/tmp.dC4tGj6Zlj/elastic-compute-cloud-
sitef/ansible/rollback_from_status.yml as an inventory source
[WARNING]:  * Failed to parse /tmp/tmp.dC4tGj6Zlj/elastic-compute-cloud-
sitef/ansible/rollback_per_machine.yml with auto plugin: no root 'plugin' key
found, '/tmp/tmp.dC4tGj6Zlj/elastic-compute-cloud-
sitef/ansible/rollback_per_machine.yml' is not a valid YAML inventory plugin
config file
[WARNING]:  * Failed to parse /tmp/tmp.dC4tGj6Zlj/elastic-compute-cloud-
sitef/ansible/rollback_per_machine.yml with yaml plugin: YAML inventory has
invalid structure, it should be a dictionary, got: &lt;class
'ansible.parsing.yaml.objects.AnsibleSequence'>
[WARNING]:  * Failed to parse /tmp/tmp.dC4tGj6Zlj/elastic-compute-cloud-
sitef/ansible/rollback_per_machine.yml with ini plugin:
/tmp/tmp.dC4tGj6Zlj/elastic-compute-cloud-
sitef/ansible/rollback_per_machine.yml:3: Expected key=value host variable
assignment, got: name:
[WARNING]: Unable to parse /tmp/tmp.dC4tGj6Zlj/elastic-compute-cloud-
sitef/ansible/rollback_per_machine.yml as an inventory source
[WARNING]: Unable to parse /tmp/tmp.dC4tGj6Zlj/elastic-compute-cloud-
sitef/ansible as an inventory source
[WARNING]: No inventory was parsed, only implicit localhost is available
[WARNING]: provided hosts list is empty, only localhost is available. Note that
the implicit localhost does not match 'all'
PLAY [Predeploy a partir do arquivo de execução] *******************************
TASK [Gathering Facts] *********************************************************
ok: [localhost]
TASK [Resolver filestore_env e filestore_base_dir sem recursão] ****************
ok: [localhost]
TASK [Mostrar variáveis de entrada e resolvidas] *******************************
ok: [localhost] => {
    "msg": [
        "execution_file_name          = execution/machine_list_dev.yml",
        "deployment_ref               = DEV000000007",
        "repo_root_resolved           = /tmp/tmp.dC4tGj6Zlj/elastic-compute-cloud-sitef/ansible/..",
        "status_dir_resolved          = /tmp/tmp.dC4tGj6Zlj/elastic-compute-cloud-sitef/ansible/../status/DEV000000007",
        "filestore_env_resolved       = dev",
        "filestore_base_dir_resolved  = dev/DEV000000007",
        "nexus_base_url               = https://nexus-ci.onefiserv.net/repository/raw-apm0004548-dev"
    ]
}
TASK [Criar diretório de status da TAG] ****************************************
changed: [localhost]
TASK [Carregar arquivo de execução] ********************************************
ok: [localhost]
TASK [Falhar se não tiver máquinas no arquivo de execução] *********************
skipping: [localhost]
TASK [Executar pré-deploy por máquina] *****************************************
included: /tmp/tmp.dC4tGj6Zlj/elastic-compute-cloud-sitef/ansible/predeploy_per_machine.yml for localhost => (item=sitef-01)
TASK [Definir máquina atual] ***************************************************
skipping: [localhost]
TASK [Definir caminhos para sitef-01] ******************************************
fatal: [localhost]: FAILED! => {"msg": "The task includes an option with an undefined variable. The error was: 'execution_dir' is undefined. 'execution_dir' is undefined\n\nThe error appears to be in '/tmp/tmp.dC4tGj6Zlj/elastic-compute-cloud-sitef/ansible/predeploy_per_machine.yml': line 31, column 3, but may\nbe elsewhere in the file depending on the exact syntax problem.\n\nThe offending line appears to be:\n\n# -----------------------------------------------------------------------------\n- name: \"Definir caminhos para {{ machine_name }}\"\n  ^ here\nWe could be wrong, but this one looks like it might be an issue with\nmissing quotes. Always quote template expression brackets when they\nstart a value. For instance:\n\n    with_items:\n      - {{ foo }}\n\nShould be written as:\n\n    with_items:\n      - \"{{ foo }}\"\n"}
PLAY RECAP *********************************************************************
localhost                  : ok=6    changed=1    unreachable=0    failed=1    skipped=2    rescued=0    ignored=0   
Command finished with status FAILURE


# predeploy_per_machine.yml
---
# =====================================================================================
# PREDEPLOY POR MÁQUINA
# Arquivo incluído pelo predeploy_from_execution.yml
#
# Este arquivo roda 1x por máquina (loop item=sitef-01, etc.)
# Objetivos:
# - Definir paths locais e remotos
# - Carregar config de máquina
# - Validar package definidos
# - Carregar config do pacote
# - Validar script/components do pacote
# - Registrar host dinâmico
# - Preparar diretórios
# - Limpar pasta de scripts (SEM usar "warn" no command)
# - Criar status inicial
# =====================================================================================

# -----------------------------------------------------------------------------
# 1) Normalizar nome da máquina (compatível com include loop padrão)
# -----------------------------------------------------------------------------
- name: "Definir máquina atual"
  ansible.builtin.set_fact:
    machine_name: "{{ item }}"
  when: machine_name is not defined

# -----------------------------------------------------------------------------
# 2) Definir caminhos para a máquina
#    Ajuste APENAS ESTES PATHS se teu repo tiver layout diferente.
# -----------------------------------------------------------------------------
- name: "Definir caminhos para {{ machine_name }}"
  ansible.builtin.set_fact:
    # --- Repo ---
    # repo_root_resolved vem do predeploy_from_execution.yml (log mostra isso)
    execution_dir: "{{ repo_root_resolved }}/execution"
    machines_dir: "{{ execution_dir }}/machines"
    packages_dir: "{{ repo_root_resolved }}/packages"

    # --- Arquivo da máquina ---
    machine_file: "{{ machines_dir }}/{{ machine_name }}.yml"

    # --- Diretório de status ---
    # status_dir_resolved vem do predeploy_from_execution.yml
    machine_status_dir: "{{ status_dir_resolved }}/{{ machine_name }}"
    machine_status_file: "{{ machine_status_dir }}/status.json"

    # --- Deploy remoto ---
    deploy_base_dir: "/opt/SoftwareExpress/sitef-pipeline/deploy"
    deploy_scripts_dir: "/opt/SoftwareExpress/sitef-pipeline/deploy/scripts"
    deploy_scripts_package_dir: "/opt/SoftwareExpress/sitef-pipeline/deploy/scripts/package"

# -----------------------------------------------------------------------------
# 3) Validar arquivo da máquina
# -----------------------------------------------------------------------------
- name: "Validar arquivo da máquina"
  ansible.builtin.stat:
    path: "{{ machine_file }}"
  register: machine_file_stat

- name: "Falhar se arquivo da máquina não existir"
  ansible.builtin.fail:
    msg: "Arquivo de máquina não encontrado: {{ machine_file }}"
  when: not machine_file_stat.stat.exists
  # No teu log esse fail estava SKIPando.
  # Se você quer manter o comportamento do log, comente o fail acima e use:
  # when: false

# -----------------------------------------------------------------------------
# 4) Carregar config da máquina
# -----------------------------------------------------------------------------
- name: "Carregar config da máquina {{ machine_name }}"
  ansible.builtin.include_vars:
    file: "{{ machine_file }}"
    name: machine_cfg

# -----------------------------------------------------------------------------
# 5) Validar package definido
# -----------------------------------------------------------------------------
- name: "Validar package definido"
  ansible.builtin.assert:
    that:
      - machine_cfg is defined
      - machine_cfg.package is defined
      - (machine_cfg.package | string | length) > 0
    fail_msg: "machine_cfg.package não definido em {{ machine_file }}"
    success_msg: "All assertions passed"

# -----------------------------------------------------------------------------
# 6) Carregar config do pacote
#    Aqui assumo que existe um YAML em packages/<package>.yml
# -----------------------------------------------------------------------------
- name: "Carregar config do pacote {{ machine_cfg.package }}"
  ansible.builtin.include_vars:
    file: "{{ packages_dir }}/{{ machine_cfg.package }}.yml"
    name: package_cfg

# -----------------------------------------------------------------------------
# 7) Validar script do pacote
# -----------------------------------------------------------------------------
- name: "Validar script do pacote"
  ansible.builtin.assert:
    that:
      - package_cfg is defined
      # ajuste o nome do campo conforme teu padrão
      # Ex.: package_cfg.script, package_cfg.scripts, etc.
      - package_cfg.script is defined or package_cfg.scripts is defined
    fail_msg: "Config de script ausente no pacote {{ machine_cfg.package }}"
    success_msg: "All assertions passed"

# -----------------------------------------------------------------------------
# 8) Validar components do pacote
# -----------------------------------------------------------------------------
- name: "Validar components do pacote"
  ansible.builtin.assert:
    that:
      # ajuste o campo conforme teu padrão real
      - package_cfg.components is defined
      - package_cfg.components | length > 0
    fail_msg: "components ausente/vazio no pacote {{ machine_cfg.package }}"
    success_msg: "All assertions passed"

# -----------------------------------------------------------------------------
# 9) Definir usuário alvo padrão
# -----------------------------------------------------------------------------
- name: "Definir usuário alvo padrão"
  ansible.builtin.set_fact:
    target_user: "{{ machine_cfg.target_user | default('root') }}"

# -----------------------------------------------------------------------------
# 10) Definir ssh_common_args padrão
# -----------------------------------------------------------------------------
- name: "Definir ssh_common_args padrão"
  ansible.builtin.set_fact:
    ssh_common_args: "{{ machine_cfg.ssh_common_args | default('-o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null') }}"

# -----------------------------------------------------------------------------
# 11) Aplicar ProxyJump via bastion (quando necessário)
#     Mantido para bater com o log (task pode skipar)
# -----------------------------------------------------------------------------
- name: "Aplicar ProxyJump via bastion (quando necessário)"
  ansible.builtin.set_fact:
    ssh_common_args: >-
      {{ ssh_common_args }}
      -o ProxyJump={{ machine_cfg.bastion_user | default(target_user) }}@{{ machine_cfg.bastion_host }}
  when:
    - machine_cfg.bastion_host is defined
    - machine_cfg.bastion_host | string | length > 0

# -----------------------------------------------------------------------------
# 12) Registrar host dinâmico para {{ machine_name }}
#     Isso permite delegate_to e uso do host em tasks seguintes
# -----------------------------------------------------------------------------
- name: "Registrar host dinâmico para {{ machine_name }}"
  ansible.builtin.add_host:
    name: "{{ machine_name }}"
    ansible_host: "{{ machine_cfg.ip | default(machine_cfg.ansible_host) }}"
    ansible_user: "{{ target_user }}"
    ansible_ssh_common_args: "{{ ssh_common_args }}"
  changed_when: true

# -----------------------------------------------------------------------------
# 13) Montar env final
#     Aqui você pode juntar variáveis globais + machine_cfg + package_cfg
# -----------------------------------------------------------------------------
- name: "Montar env final"
  ansible.builtin.set_fact:
    env_final:
      MACHINE_NAME: "{{ machine_name }}"
      DEPLOYMENT_REF: "{{ deployment_ref | default('') }}"
      FILESTORE_ENV: "{{ filestore_env_resolved | default('') }}"
      FILESTORE_BASE_DIR: "{{ filestore_base_dir_resolved | default('') }}"
      NEXUS_BASE_URL: "{{ nexus_base_url | default('') }}"
      PACKAGE: "{{ machine_cfg.package }}"
      # Você pode adicionar qualquer var necessária ao teu script
      # Ex.: versões específicas, paths, feature flags, etc.

# -----------------------------------------------------------------------------
# 14) Criar status inicial (queued)
# -----------------------------------------------------------------------------
- name: "Criar status inicial (queued)"
  ansible.builtin.file:
    path: "{{ machine_status_dir }}"
    state: directory
    mode: "0755"

- name: "Escrever status inicial (queued)"
  ansible.builtin.copy:
    dest: "{{ machine_status_file }}"
    mode: "0644"
    content: |
      {
        "machine": "{{ machine_name }}",
        "package": "{{ machine_cfg.package }}",
        "status": "queued",
        "deployment_ref": "{{ deployment_ref | default('') }}",
        "filestore_env": "{{ filestore_env_resolved | default('') }}",
        "filestore_base_dir": "{{ filestore_base_dir_resolved | default('') }}"
      }
  changed_when: true

# -----------------------------------------------------------------------------
# 15) Garantir base do pipeline no host
# -----------------------------------------------------------------------------
- name: "Garantir base do pipeline no host"
  ansible.builtin.file:
    path: "{{ item }}"
    state: directory
    mode: "0755"
  become: true
  delegate_to: "{{ machine_name }}"
  loop:
    - "{{ deploy_base_dir }}"
    - "{{ deploy_scripts_dir }}"
    - "{{ deploy_scripts_package_dir }}"

# -----------------------------------------------------------------------------
# 16) Limpar pasta de scripts do predeploy
#     ✅ CORREÇÃO DEFINITIVA: nada de "warn" no command.
#     Usar file é o jeito mais seguro e compatível.
# -----------------------------------------------------------------------------
- name: "Limpar pasta de scripts do predeploy"
  ansible.builtin.file:
    path: "{{ deploy_scripts_package_dir }}"
    state: absent
  become: true
  delegate_to: "{{ machine_name }}"

- name: "Recriar pasta de scripts do pacote"
  ansible.builtin.file:
    path: "{{ deploy_scripts_package_dir }}"
    state: directory
    mode: "0755"
  become: true
  delegate_to: "{{ machine_name }}"

# -----------------------------------------------------------------------------
# 17) (Opcional) Copiar scripts do pacote / preparar execução
#     Ajuste conforme tua estrutura real de scripts.
# -----------------------------------------------------------------------------
- name: "Copiar scripts do pacote para o host"
  ansible.builtin.copy:
    src: "{{ repo_root_resolved }}/scripts/package/{{ machine_cfg.package }}/"
    dest: "{{ deploy_scripts_package_dir }}/"
    mode: "0755"
  become: true
  delegate_to: "{{ machine_name }}"
  ignore_errors: true
  # ignore_errors porque eu não sei se esse path existe no teu repo.
  # Se existir, remova o ignore_errors.

# -----------------------------------------------------------------------------
# 18) (Opcional) Atualizar status para 'predeploy_ready'
# -----------------------------------------------------------------------------
- name: "Atualizar status para predeploy_ready"
  ansible.builtin.copy:
    dest: "{{ machine_status_file }}"
    mode: "0644"
    content: |
      {
        "machine": "{{ machine_name }}",
        "package": "{{ machine_cfg.package }}",
        "status": "predeploy_ready",
        "deployment_ref": "{{ deployment_ref | default('') }}",
        "filestore_env": "{{ filestore_env_resolved | default('') }}",
        "filestore_base_dir": "{{ filestore_base_dir_resolved | default('') }}",
        "nexus_base_url": "{{ nexus_base_url | default('') }}"
      }
  changed_when: true

#predeploy_from_execution.yml
# predeploy_from_execution.yml
#
# PIPELINE 1 - PREDEPLOY
# - Lê execution/<arquivo>.yml
# - Para cada máquina:
#   * carrega machine + package
#   * exporta env_vars (merge)
#   * prepara área /opt/SoftwareExpress/sitef-pipeline/deploy
#   * limpa scripts
#   * copia package.yml
#   * baixa componentes do Nexus
#   * copia scripts do repo
#   * executa init_parallel.sh
#   * gera status JSON
#   * envia JSON + LOG para Harness File Store
#
# CORREÇÃO PRINCIPAL:
# - NÃO declarar filestore_env nem filestore_base_dir no vars
#   para evitar recursão caso o pipeline já injete essas variáveis.
# - Resolver valores com set_fact usando defaults seguros.

- name: "Predeploy a partir do arquivo de execução"
  hosts: localhost
  connection: local
  gather_facts: true

  vars:
    # -------------------------------
    # Entradas principais
    # -------------------------------
    execution_file_name: "{{ execution_file_name | default('execution/machine_list_dev.yml') }}"
    deployment_ref: "{{ deployment_ref | default('DEV000000001') }}"

    # -------------------------------
    # Paths do repositório
    # -------------------------------
    repo_root_resolved: "{{ playbook_dir }}/.."
    status_dir_resolved: "{{ (playbook_dir ~ '/..') }}/status/{{ deployment_ref }}"

    # -------------------------------
    # Nexus (ideal vir do Harness Secrets)
    # -------------------------------
    nexus_base_url: "{{ nexus_base_url | default('https://nexus-ci.onefiserv.net/repository/raw-apm0004548-dev') }}"
    nexus_user: "{{ nexus_user | default(omit) }}"
    nexus_password: "{{ nexus_password | default(omit) }}"

  tasks:
    # ---------------------------------------
    # Resolver File Store sem recursão
    # ---------------------------------------
    - name: Resolver filestore_env e filestore_base_dir sem recursão
      ansible.builtin.set_fact:
        filestore_env_resolved: >-
          {{
            (filestore_env | string | trim)
              if (filestore_env is defined and (filestore_env | string | trim) | length > 0)
              else 'dev'
          }}
        filestore_base_dir_resolved: >-
          {{
            (filestore_base_dir | string | trim)
              if (filestore_base_dir is defined and (filestore_base_dir | string | trim) | length > 0)
              else (
                (
                  (filestore_env | string | trim)
                    if (filestore_env is defined and (filestore_env | string | trim) | length > 0)
                    else 'dev'
                ) ~ '/' ~ deployment_ref
              )
          }}

    # ---------------------------------------
    # Mostrar variáveis resolvidas
    # ---------------------------------------
    - name: "Mostrar variáveis de entrada e resolvidas"
      ansible.builtin.debug:
        msg:
          - "execution_file_name          = {{ execution_file_name }}"
          - "deployment_ref               = {{ deployment_ref }}"
          - "repo_root_resolved           = {{ repo_root_resolved }}"
          - "status_dir_resolved          = {{ status_dir_resolved }}"
          - "filestore_env_resolved       = {{ filestore_env_resolved }}"
          - "filestore_base_dir_resolved  = {{ filestore_base_dir_resolved }}"
          - "nexus_base_url               = {{ nexus_base_url }}"

    # ---------------------------------------
    # Criar diretório de status local
    # ---------------------------------------
    - name: "Criar diretório de status da TAG"
      ansible.builtin.file:
        path: "{{ status_dir_resolved }}"
        state: directory
        mode: "0755"

    # ---------------------------------------
    # Carregar arquivo de execução
    # ---------------------------------------
    - name: "Carregar arquivo de execução"
      ansible.builtin.include_vars:
        file: "{{ repo_root_resolved }}/{{ execution_file_name }}"
        name: execution_cfg

    # ---------------------------------------
    # Validar se há máquinas
    # ---------------------------------------
    - name: "Falhar se não tiver máquinas no arquivo de execução"
      ansible.builtin.fail:
        msg: "Nenhuma máquina encontrada em execution_cfg.machines"
      when: execution_cfg.machines is not defined or execution_cfg.machines | length == 0

    # ---------------------------------------
    # Executar pré-deploy por máquina
    # ---------------------------------------
    - name: "Executar pré-deploy por máquina"
      ansible.builtin.include_tasks: predeploy_per_machine.yml
      loop: "{{ execution_cfg.machines }}"
      loop_control:
        loop_var: machine_name
      vars:
        # Variáveis esperadas pelo tasks file
        deployment_ref: "{{ deployment_ref }}"
        repo_root: "{{ repo_root_resolved }}"
        status_dir: "{{ status_dir_resolved }}"

        nexus_base_url: "{{ nexus_base_url }}"
        nexus_user: "{{ nexus_user | default('') }}"
        nexus_password: "{{ nexus_password | default('') }}"

        filestore_env: "{{ filestore_env_resolved }}"
        filestore_base_dir: "{{ filestore_base_dir_resolved }}"
